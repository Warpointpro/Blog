{% extends 'base.html' %}
{% load static %}

{% block title %}Inicio - Blog de Ayuda a Programadores{% endblock %}

{% block content %}
    <form method="get" class="search-bar">
        <input type="text" name="q" placeholder="Buscar posteos..." value="{{ request.GET.q }}">
        <select name="categoria">
            <option value="">Todas las categorías</option>
            {% for cat in categorias %}
                <option value="{{ cat.id }}" {% if request.GET.categoria == cat.id|stringformat:"s" %}selected{% endif %}>
                    {{ cat.nombre }}
                </option>
            {% endfor %}
        </select>
        <select name="fecha">
            <option value="">Orden por fecha</option>
            <option value="asc" {% if request.GET.fecha == "asc" %}selected{% endif %}>Antiguo primero</option>
            <option value="desc" {% if request.GET.fecha == "desc" %}selected{% endif %}>Reciente primero</option>
        </select>
        <select name="comentarios">
        <option value="">Todos</option>
        <option value="con" {% if request.GET.noticias == "con" %}selected{% endif %}>Con comentarios</option>
        <option value="sin" {% if request.GET.noticias == "sin" %}selected{% endif %}>Sin comentarios</option>
</select>
        <button type="submit">Filtrar</button>
    </form>
    <h2>Últimos Posteos</h2>
    {% if page_obj %}
    {% for noticia in page_obj %}
            <article class="post">
                <h3>
                    <a href="{% url 'post_detail' noticia.pk %}">{{ noticia.titulo }}</a>
                </h3>

                <div class="post-meta">
                    <small>Categoría: {{ noticia.categoria.nombre }}</small>
                    <small>Autor: {{ noticia.autor.username }}</small>
                    <small>Fecha: {{ noticia.fecha|date:"d M Y" }}</small>
                </div>
                
                {% if noticia.imagen %}
                    <a href="{% url 'post_detail' noticia.pk %}">
                        <img src="{{ noticia.imagen.url }}" alt="{{ noticia.titulo }}">
                    </a>
                {% endif %}

                <p>{{ noticia.contenido|truncatewords:30 }}</p>
                <a href="{% url 'post_detail' noticia.pk %}" class="read-more">Leer más</a>
            </article>
        {% endfor %}
    {% else %}
        <p>No hay publicaciones que coincidan con el filtro.</p>
    {% endif %}
    <div class="pagination">
    {% for num in page_obj.paginator.page_range %}
        {% if num == page_obj.number %}
            <span class="current">{{ num }}</span>
        {% else %}
            <a href="?page={{ num }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}{% if request.GET.categoria %}&categoria={{ request.GET.categoria }}{% endif %}{% if request.GET.fecha %}&fecha={{ request.GET.fecha }}{% endif %}">
                {{ num }}
            </a>
        {% endif %}
    {% endfor %}
</div>

<style>
.pagination {
    display: flex;
    gap: .5rem;
    justify-content: center;
    margin-top: 1.5rem;
}
.pagination a, .pagination span {
    display: inline-block;
    padding: .4rem .8rem;
    border-radius: 6px;
    text-decoration: none;
    font-weight: 600;
}
.pagination a {
    background: #f1f1f1;
    color: #333;
}
.pagination a:hover {
    background: #0d6efd;
    color: #fff;
}
.pagination .current {
    background: #0d6efd;
    color: #fff;
}
</style>

{% endblock %}

